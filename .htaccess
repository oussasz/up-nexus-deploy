RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Handle API requests - proxy to Node.js
RewriteCond %{REQUEST_URI} ^/api
RewriteRule ^(.*)$ http://127.0.0.1:3000/$1 [P,L]

# Redirect legacy /pages/*.html URLs to clean routes (301 redirect)
RewriteCond %{THE_REQUEST} \s/+pages/([^\s?]+)\.html [NC]
RewriteRule ^ /%1 [L,R=301,NE]

# Serve root index.html from public folder
RewriteRule ^$ /public/index.html [L]

# Clean URL rewrites - internally serve the actual HTML files from /public/
RewriteRule ^ecosystem$ /public/pages/ecosystem.html [L]
RewriteRule ^contact$ /public/pages/contact.html [L]
RewriteRule ^about$ /public/pages/about.html [L]
RewriteRule ^announcements$ /public/pages/announcements.html [L]
RewriteRule ^pricing$ /public/pages/pricing.html [L]
RewriteRule ^auth/login$ /public/pages/auth/login.html [L]
RewriteRule ^auth/register$ /public/pages/auth/register.html [L]
RewriteRule ^auth/forgot$ /public/pages/auth/forgot.html [L]
RewriteRule ^admin/login$ /public/pages/admin/login.html [L]
RewriteRule ^admin/dashboard$ /public/pages/admin/dashboard.html [L]
RewriteRule ^dashboard$ /public/pages/dashboard/index.html [L]
RewriteRule ^dashboard/pending$ /public/pages/dashboard/pending.html [L]

# Serve static assets from public folder (CSS, JS, images, etc.)
RewriteCond %{REQUEST_URI} !^/public/
RewriteCond %{REQUEST_URI} !^/api
RewriteCond %{DOCUMENT_ROOT}/public%{REQUEST_URI} -f
RewriteRule ^(.*)$ /public/$1 [L]
